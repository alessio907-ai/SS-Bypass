# =====================================================
# INJECTABLE CHEAT DETECTOR - DETAILED REPORT
# =====================================================

$ErrorActionPreference = "SilentlyContinue"

# ---------------- UI DESIGN ----------------
function Show-Header {
    Clear-Host
    Write-Host ""
    Write-Host "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Cyan
    Write-Host "â•‘" -NoNewline -ForegroundColor Cyan
    Write-Host "         ğŸ” INJECTABLE CHEAT DETECTOR v2.0            " -NoNewline -ForegroundColor Yellow
    Write-Host "â•‘" -ForegroundColor Cyan
    Write-Host "â•‘" -NoNewline -ForegroundColor Cyan
    Write-Host "          Detaillierte Analyse & Report              " -NoNewline -ForegroundColor White
    Write-Host "â•‘" -ForegroundColor Cyan
    Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan
    Write-Host ""
}

function Show-Section($title) {
    Write-Host ""
    Write-Host "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”" -ForegroundColor DarkCyan
    Write-Host "â”‚ $title" -ForegroundColor Cyan
    Write-Host "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜" -ForegroundColor DarkCyan
    Write-Host ""
}

function Show-Finding($type, $title, $details) {
    switch ($type) {
        "CRITICAL" { 
            Write-Host "  ğŸ”´ " -NoNewline -ForegroundColor Red
            Write-Host "$title" -ForegroundColor White
        }
        "WARNING" { 
            Write-Host "  ğŸŸ¡ " -NoNewline -ForegroundColor Yellow
            Write-Host "$title" -ForegroundColor White
        }
        "INFO" { 
            Write-Host "  ğŸ”µ " -NoNewline -ForegroundColor Blue
            Write-Host "$title" -ForegroundColor White
        }
        "SAFE" { 
            Write-Host "  âœ… " -NoNewline -ForegroundColor Green
            Write-Host "$title" -ForegroundColor White
        }
    }
    
    foreach ($detail in $details) {
        Write-Host "     â””â”€ " -NoNewline -ForegroundColor DarkGray
        Write-Host "$detail" -ForegroundColor Gray
    }
    Write-Host ""
}

# ---------------- MAIN SCAN ----------------
Show-Header

Write-Host "  ğŸ‘¤ Benutzer: " -NoNewline -ForegroundColor DarkGray
Write-Host "$env:USERNAME" -ForegroundColor White

Write-Host "  ğŸ’» Computer: " -NoNewline -ForegroundColor DarkGray
Write-Host "$env:COMPUTERNAME" -ForegroundColor White

Write-Host "  ğŸ• Scan gestartet: " -NoNewline -ForegroundColor DarkGray
Write-Host "$(Get-Date -Format 'HH:mm:ss')" -ForegroundColor White

Write-Host ""
Write-Host "  ğŸ”„ Analysiere System..." -ForegroundColor Cyan

# ---------------- 1. JAVA PROZESS ANALYSE ----------------
Show-Section "ğŸ“Š JAVA PROZESS ANALYSE"

$javaProcesses = Get-Process | Where-Object { $_.ProcessName -match "java|javaw" }
$processFindings = @()

if ($javaProcesses.Count -eq 0) {
    Show-Finding "SAFE" "Keine Java-Prozesse gefunden" @("System ist sauber")
} else {
    Show-Finding "INFO" "$($javaProcesses.Count) Java-Prozesse gefunden" @("Beginne detaillierte Analyse")
    
    foreach ($proc in $javaProcesses) {
        Write-Host ""
        Write-Host "  ğŸ® Prozess: " -NoNewline -ForegroundColor DarkCyan
        Write-Host "$($proc.ProcessName)" -NoNewline -ForegroundColor White
        Write-Host " (PID: " -NoNewline -ForegroundColor DarkGray
        Write-Host "$($proc.Id)" -NoNewline -ForegroundColor White
        Write-Host ")" -ForegroundColor DarkGray
        
        # 1A. COMMAND LINE ANALYSE
        try {
            $cmdLine = (Get-CimInstance Win32_Process -Filter "ProcessId=$($proc.Id)").CommandLine
            
            if ($cmdLine) {
                $cmdFindings = @()
                
                # JavaAgent Detection
                if ($cmdLine -match "-javaagent:(.*?\.jar)") {
                    $agentPath = $matches[1]
                    $cmdFindings += "ğŸ”´ JavaAgent Injection erkannt"
                    $cmdFindings += "ğŸ“ Pfad: $agentPath"
                    $cmdFindings += "âš ï¸ ErmÃ¶glicht Code-Injection in JVM"
                    
                    $processFindings += [PSCustomObject]@{
                        Type = "CRITICAL"
                        Title = "JavaAgent Injection in PID $($proc.Id)"
                        Details = @(
                            "Datei: $(Split-Path $agentPath -Leaf)",
                            "Voller Pfad: $agentPath",
                            "Grund: -javaagent Parameter erlaubt Code-Injection",
                            "Risiko: HOCH - Kann beliebigen Code ausfÃ¼hren"
                        )
                    }
                }
                
                # NoVerify Detection
                if ($cmdLine -match "-noverify|-Xverify:none") {
                    $cmdFindings += "ğŸ”´ Bytecode-Verification deaktiviert"
                    $cmdFindings += "âš ï¸ ErmÃ¶glicht modifizierten Code"
                }
                
                # Bootclasspath Injection
                if ($cmdLine -match "-Xbootclasspath") {
                    $cmdFindings += "ğŸŸ¡ Bootclasspath Manipulation"
                    $cmdFindings += "âš ï¸ Kann System-Klassen ersetzen"
                }
                
                if ($cmdFindings.Count -gt 0) {
                    Show-Finding "CRITICAL" "VerdÃ¤chtige JVM Argumente" $cmdFindings
                } else {
                    Write-Host "     âœ… Keine verdÃ¤chtigen JVM Argumente" -ForegroundColor Green
                }
            }
        } catch {
            Write-Host "     âš ï¸ Command Line nicht lesbar" -ForegroundColor Yellow
        }
        
        # 1B. DLL MODULE ANALYSE
        try {
            $dllModules = $proc.Modules | Where-Object { $_.ModuleName -match "\.dll$" }
            $suspiciousDLLs = @()
            
            foreach ($dll in $dllModules) {
                $dllPath = $dll.FileName.ToLower()
                $dllName = $dll.ModuleName
                $reasons = @()
                
                # DLL Name Checks
                if ($dllName -match "inject|hook|loader|cheat|hack") {
                    $reasons += "ğŸ”´ Name enthÃ¤lt Cheat-Keywords: '$($dllName)'"
                }
                
                # Path Location Checks
                if ($dllPath -match "\\temp\\|\\appdata\\|\\downloads\\|\\desktop\\") {
                    if ($dllPath -notmatch "\\windows\\|\\system32\\|\\java\\|\\jre\\") {
                        $reasons += "ğŸŸ¡ DLL in Benutzer-Ordner: $(Split-Path $dllPath -Parent)"
                    }
                }
                
                # Known Cheat DLLs
                $cheatDLLs = @{
                    "inject.dll" = "Generische Injection-DLL";
                    "hook.dll" = "Process Hook DLL";
                    "prestige.dll" = "Prestige Client DLL";
                    "meteor.dll" = "Meteor Client DLL";
                    "wurst.dll" = "Wurst Client DLL";
                    "ac.dll" = "AutoClicker/Cheat DLL";
                }
                
                foreach ($cheatName in $cheatDLLs.Keys) {
                    if ($dllName -match $cheatName) {
                        $reasons += "ğŸ”´ Bekannte Cheat-DLL: $($cheatDLLs[$cheatName])"
                    }
                }
                
                # File Signature Check
                try {
                    $signature = Get-AuthenticodeSignature $dll.FileName -ErrorAction SilentlyContinue
                    if ($signature -and $signature.Status -ne "Valid") {
                        $reasons += "ğŸŸ¡ Nicht signiert oder ungÃ¼ltige Signatur"
                    }
                } catch {
                    $reasons += "ğŸŸ¡ Signatur nicht Ã¼berprÃ¼fbar"
                }
                
                if ($reasons.Count -gt 0) {
                    $suspiciousDLLs += [PSCustomObject]@{
                        Name = $dllName
                        Path = $dll.FileName
                        Reasons = $reasons
                    }
                }
            }
            
            if ($suspiciousDLLs.Count -gt 0) {
                Show-Finding "CRITICAL" "$($suspiciousDLLs.Count) verdÃ¤chtige DLLs geladen" @(
                    "Prozess hat modifizierte/injizierte DLLs"
                )
                
                foreach ($dll in $suspiciousDLLs) {
                    Write-Host ""
                    Write-Host "     ğŸ“¦ DLL: " -NoNewline -ForegroundColor Gray
                    Write-Host "$($dll.Name)" -ForegroundColor White
                    Write-Host "        ğŸ“ " -NoNewline -ForegroundColor DarkGray
                    Write-Host "$($dll.Path)" -ForegroundColor Gray
                    
                    foreach ($reason in $dll.Reasons) {
                        Write-Host "        âš ï¸  $reason" -ForegroundColor Yellow
                    }
                    
                    # File Details
                    try {
                        $fileInfo = Get-Item $dll.Path -ErrorAction Stop
                        $sizeMB = [math]::Round($fileInfo.Length / 1MB, 2)
                        $modified = $fileInfo.LastWriteTime.ToString("dd.MM.yyyy HH:mm")
                        
                        Write-Host "        ğŸ“Š GrÃ¶ÃŸe: " -NoNewline -ForegroundColor DarkGray
                        Write-Host "${sizeMB} MB" -ForegroundColor Gray
                        Write-Host "        ğŸ• Modifiziert: " -NoNewline -ForegroundColor DarkGray
                        Write-Host $modified -ForegroundColor Gray
                        
                        $processFindings += [PSCustomObject]@{
                            Type = "CRITICAL"
                            Title = "VerdÃ¤chtige DLL in $($proc.ProcessName)"
                            Details = @(
                                "DLL: $($dll.Name)",
                                "Pfad: $($dll.Path)",
                                "GrÃ¶ÃŸe: ${sizeMB} MB",
                                "Modifiziert: $modified",
                                "GrÃ¼nde: $($dll.Reasons -join ', ')",
                                "Risiko: HOCH - Prozess modifiziert"
                            )
                        }
                    } catch {
                        Write-Host "        âš ï¸  Datei-Info nicht verfÃ¼gbar" -ForegroundColor Yellow
                    }
                }
            } else {
                Write-Host "     âœ… Keine verdÃ¤chtigen DLLs" -ForegroundColor Green
            }
            
        } catch {
            Write-Host "     âš ï¸  DLL Analyse fehlgeschlagen" -ForegroundColor Yellow
        }
    }
}

# ---------------- 2. DATEI SYSTEM SCAN ----------------
Show-Section "ğŸ“ DATEI SYSTEM SCAN"

$fileFindings = @()

# 2A. MINECRAFT MODS ORDNER
$mcModsPath = "$env:APPDATA\.minecraft\mods"
if (Test-Path $mcModsPath) {
    $suspiciousMods = Get-ChildItem $mcModsPath -Filter "*.jar" -ErrorAction SilentlyContinue | 
                     Where-Object { $_.Name -match "prestige|inject|cheat|hack|client" }
    
    if ($suspiciousMods.Count -gt 0) {
        Show-Finding "WARNING" "$($suspiciousMods.Count) verdÃ¤chtige JARs in Mods-Ordner" @(
            "MÃ¶gliche Cheat-Mods erkannt"
        )
        
        foreach ($mod in $suspiciousMods) {
            Write-Host ""
            Write-Host "     ğŸ“¦ JAR: " -NoNewline -ForegroundColor Gray
            Write-Host "$($mod.Name)" -ForegroundColor White
            
            $fileFindings += [PSCustomObject]@{
                Type = "WARNING"
                Title = "VerdÃ¤chtige Mod-Datei"
                Details = @(
                    "Datei: $($mod.Name)",
                    "Pfad: $($mod.FullName)",
                    "GrÃ¶ÃŸe: $([math]::Round($mod.Length/1MB,2)) MB",
                    "Grund: Name enthÃ¤lt Cheat-Keywords",
                    "Risiko: MITTEL - Kann Cheat-Funktionen enthalten"
                )
            }
        }
    } else {
        Write-Host "  âœ… Mods-Ordner: Keine verdÃ¤chtigen JARs" -ForegroundColor Green
    }
}

# 2B. TEMP ORDNER FÃœR INJEKTIONEN
$tempCheats = Get-ChildItem $env:TEMP -Recurse -Filter "*.jar" -ErrorAction SilentlyContinue | 
              Where-Object { $_.Name -match "inject|loader|agent|cheat" } |
              Select-Object -First 5

if ($tempCheats.Count -gt 0) {
    Show-Finding "CRITICAL" "VerdÃ¤chtige Dateien in Temp-Ordner" @(
        "MÃ¶gliche Injection-Dateien gefunden"
    )
    
    foreach ($file in $tempCheats) {
        $age = [math]::Round(((Get-Date) - $file.LastWriteTime).TotalMinutes, 0)
        
        Write-Host ""
        Write-Host "     ğŸ“¦ Datei: " -NoNewline -ForegroundColor Gray
        Write-Host "$($file.Name)" -ForegroundColor White
        Write-Host "        ğŸ“ $($file.FullName)" -ForegroundColor Gray
        Write-Host "        ğŸ• Alter: " -NoNewline -ForegroundColor DarkGray
        Write-Host "${age} Minuten" -ForegroundColor $(if ($age -lt 10) { "Red" } else { "Gray" })
        
        $fileFindings += [PSCustomObject]@{
            Type = "CRITICAL"
            Title = "VerdÃ¤chtige Temp-Datei"
            Details = @(
                "Datei: $($file.Name)",
                "Pfad: $($file.FullName)",
                "Alter: ${age} Minuten",
                "Grund: In Temp-Ordner mit Cheat-Namen",
                "Risiko: HOCH - KÃ¼rzlich erstellt/verwendet"
            )
        }
    }
}

# ---------------- 3. REGISTRY SCAN ----------------
Show-Section "âš™ï¸ REGISTRY ANALYSE"

$registryFindings = @()

$runKeys = @(
    "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run",
    "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run"
)

foreach ($key in $runKeys) {
    if (Test-Path $key) {
        $entries = Get-ItemProperty -Path $key -ErrorAction SilentlyContinue
        
        foreach ($entry in $entries.PSObject.Properties) {
            if ($entry.Name -notmatch "PS.*" -and $entry.Value) {
                $value = $entry.Value.ToString().ToLower()
                
                if ($value -match "java.*-javaagent|inject|cheat|prestige") {
                    Show-Finding "CRITICAL" "VerdÃ¤chtiger Autostart-Eintrag" @(
                        "Key: $($entry.Name)",
                        "Wert: $($entry.Value)",
                        "Pfad: $key",
                        "Grund: Startet Java mit Injection-Parametern"
                    )
                    
                    $registryFindings += [PSCustomObject]@{
                        Type = "CRITICAL"
                        Title = "VerdÃ¤chtiger Autostart"
                        Details = @(
                            "Registry: $key",
                            "Key: $($entry.Name)",
                            "Wert: $($entry.Value)",
                            "Grund: Startet mÃ¶gliche Cheat-Software",
                            "Risiko: HOCH - Startet automatisch"
                        )
                    }
                }
            }
        }
    }
}

if ($registryFindings.Count -eq 0) {
    Write-Host "  âœ… Registry: Keine verdÃ¤chtigen Autostart-EintrÃ¤ge" -ForegroundColor Green
}

# ---------------- 4. ZUSAMMENFASSUNG ----------------
Show-Section "ğŸ“‹ DETAILLIERTER REPORT"

$allFindings = $processFindings + $fileFindings + $registryFindings
$criticalCount = ($allFindings | Where-Object { $_.Type -eq "CRITICAL" }).Count
$warningCount = ($allFindings | Where-Object { $_.Type -eq "WARNING" }).Count

Write-Host "  ğŸ“Š Scan-Statistiken:" -ForegroundColor Cyan
Write-Host "     â””â”€ Java-Prozesse: " -NoNewline -ForegroundColor DarkGray
Write-Host "$($javaProcesses.Count)" -ForegroundColor White

Write-Host "     â””â”€ Gesamt-Funde: " -NoNewline -ForegroundColor DarkGray
Write-Host "$($allFindings.Count)" -ForegroundColor White

Write-Host "     â””â”€ ğŸ”´ Kritische: " -NoNewline -ForegroundColor DarkGray
Write-Host "$criticalCount" -ForegroundColor Red

Write-Host "     â””â”€ ğŸŸ¡ Warnungen: " -NoNewline -ForegroundColor DarkGray
Write-Host "$warningCount" -ForegroundColor Yellow

Write-Host ""

if ($allFindings.Count -eq 0) {
    Show-Finding "SAFE" "Systemanalyse abgeschlossen" @(
        "âœ… Keine verdÃ¤chtigen AktivitÃ¤ten gefunden",
        "âœ… Keine injektierbaren Cheats erkannt",
        "âœ… System scheint sauber zu sein"
    )
} else {
    Show-Finding $(if ($criticalCount -gt 0) { "CRITICAL" } else { "WARNING" }) "Funde im Detail" @(
        "Folgende verdÃ¤chtige Elemente wurden erkannt:"
    )
    
    Write-Host ""
    
    # Gruppiere nach Typ und zeige Details
    $grouped = $allFindings | Group-Object Type | Sort-Object @{
        Expression = { if ($_.Name -eq "CRITICAL") { 1 } elseif ($_.Name -eq "WARNING") { 2 } else { 3 } }
    }
    
    foreach ($group in $grouped) {
        $color = if ($group.Name -eq "CRITICAL") { "Red" } else { "Yellow" }
        
        Write-Host "  $(if($group.Name -eq 'CRITICAL'){'ğŸ”´'}else{'ğŸŸ¡'}) $($group.Name) FINDINGS ($($group.Count)):" -ForegroundColor $color
        
        $counter = 1
        foreach ($finding in $group.Group) {
            Write-Host ""
            Write-Host "    $counter. $($finding.Title)" -ForegroundColor White
            
            foreach ($detail in $finding.Details) {
                Write-Host "       â€¢ $detail" -ForegroundColor Gray
            }
            $counter++
        }
        Write-Host ""
    }
}

# ---------------- 5. EMPFEHLUNGEN ----------------
Show-Section "ğŸ”§ EMPFEHLUNGEN & AKTIONEN"

if ($criticalCount -gt 0) {
    Write-Host "  ğŸ”´ SOFORTIGE AKTIONEN ERFORDERLICH:" -ForegroundColor Red
    
    $actions = @(
        "1. ğŸ›‘ Alle Minecraft/Java Prozesse beenden",
        "2. ğŸ—‘ï¸ Gefundene verdÃ¤chtige Dateien lÃ¶schen:",
        "   - VerdÃ¤chtige DLLs aus Prozess-Sektion",
        "   - JavaAgent JAR-Dateien",
        "   - Temp-Cheat-Dateien",
        "3. ğŸ”„ Computer neustarten",
        "4. ğŸ“ .minecraft/mods Ordner Ã¼berprÃ¼fen",
        "5. âš™ï¸ Registry-Autostart bereinigen"
    )
    
    foreach ($action in $actions) {
        Write-Host "     $action" -ForegroundColor Yellow
    }
    
} elseif ($warningCount -gt 0) {
    Write-Host "  ğŸŸ¡ EMPFOHLENE AKTIONEN:" -ForegroundColor Yellow
    
    $actions = @(
        "1. ğŸ“ VerdÃ¤chtige Mods aus .minecraft/mods entfernen",
        "2. ğŸ§¹ Temp-Ordner bereinigen",
        "3. ğŸ” Scan nach 24 Stunden wiederholen",
        "4. âš ï¸ Mods nur von vertrauenswÃ¼rdigen Quellen installieren"
    )
    
    foreach ($action in $actions) {
        Write-Host "     $action" -ForegroundColor Cyan
    }
    
} else {
    Write-Host "  âœ… KEINE AKTIONEN ERFORDERLICH" -ForegroundColor Green
    Write-Host "     â””â”€ System ist sauber" -ForegroundColor Gray
    Write-Host "     â””â”€ RegelmÃ¤ÃŸige Scans empfehlenswert" -ForegroundColor Gray
}

# ---------------- 6. INTERAKTION ----------------
Write-Host ""
Write-Host "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”" -ForegroundColor DarkGreen
Write-Host "â”‚ ğŸ“ AKTIONEN MENÃœ                                     â”‚" -ForegroundColor Green
Write-Host "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜" -ForegroundColor DarkGreen
Write-Host ""

$menuOptions = @(
    "1. ğŸ”„ Scan wiederholen",
    "2. ğŸ“‹ Gefundene Dateien anzeigen",
    "3. ğŸ—‘ï¸ VerdÃ¤chtige Dateien lÃ¶schen",
    "4. ğŸ›‘ Java-Prozesse beenden",
    "5. ğŸ’¾ Report speichern",
    "6. ğŸšª Beenden"
)

foreach ($option in $menuOptions) {
    Write-Host "   $option" -ForegroundColor Cyan
}

$choice = Read-Host "`n   Auswahl (1-6)"

switch ($choice) {
    "1" { 
        Write-Host "`n   ğŸ”„ Starte Scan neu..." -ForegroundColor Yellow
        Start-Sleep -Seconds 2
        & $PSCommandPath 
    }
    "2" {
        Clear-Host
        Write-Host "`nğŸ“‹ GEFUNDENE DATEIEN IM DETAIL:`n" -ForegroundColor Cyan
        
        if ($allFindings.Count -eq 0) {
            Write-Host "   Keine Dateien gefunden" -ForegroundColor Green
        } else {
            foreach ($finding in $allFindings) {
                Write-Host "   $(if($finding.Type -eq 'CRITICAL'){'ğŸ”´'}else{'ğŸŸ¡'}) $($finding.Title)" -ForegroundColor $(if($finding.Type -eq 'CRITICAL'){'Red'}else{'Yellow'})
                
                foreach ($detail in $finding.Details) {
                    if ($detail -match "Datei:|Pfad:") {
                        Write-Host "      ğŸ“ $detail" -ForegroundColor Gray
                    } elseif ($detail -match "Risiko:|Grund:") {
                        Write-Host "      âš ï¸  $detail" -ForegroundColor Yellow
                    } else {
                        Write-Host "      â€¢ $detail" -ForegroundColor DarkGray
                    }
                }
                Write-Host ""
            }
        }
        
        Read-Host "`n   DrÃ¼cke Enter um fortzufahren"
        & $PSCommandPath
    }
    "3" {
        if ($allFindings.Count -gt 0) {
            Write-Host "`n   ğŸ—‘ï¸ LÃ¶sche verdÃ¤chtige Dateien..." -ForegroundColor Yellow
            
            $deleted = 0
            foreach ($finding in $allFindings) {
                foreach ($detail in $finding.Details) {
                    if ($detail -match "Pfad: (.*)") {
                        $path = $matches[1]
                        if (Test-Path $path) {
                            try {
                                Remove-Item -Path $path -Force -ErrorAction Stop
                                Write-Host "      âœ… GelÃ¶scht: $(Split-Path $path -Leaf)" -ForegroundColor Green
                                $deleted++
                            } catch {
                                Write-Host "      âŒ Fehler: $($_.Exception.Message)" -ForegroundColor Red
                            }
                        }
                    }
                }
            }
            
            Write-Host "`n      ğŸ“Š $deleted Dateien gelÃ¶scht" -ForegroundColor White
        } else {
            Write-Host "`n   â„¹ï¸ Keine Dateien zum LÃ¶schen gefunden" -ForegroundColor Yellow
        }
        
        Read-Host "`n   DrÃ¼cke Enter um fortzufahren"
        & $PSCommandPath
    }
    "4" {
        Write-Host "`n   ğŸ›‘ Beende Java-Prozesse..." -ForegroundColor Yellow
        
        $javaProcs = Get-Process | Where-Object { $_.ProcessName -match "java|javaw" }
        $stopped = 0
        
        foreach ($proc in $javaProcs) {
            try {
                Stop-Process -Id $proc.Id -Force -ErrorAction Stop
                Write-Host "      âœ… Beendet: $($proc.ProcessName) (PID: $($proc.Id))" -ForegroundColor Green
                $stopped++
            } catch {
                Write-Host "      âŒ Fehler beim Beenden: $($proc.ProcessName)" -ForegroundColor Red
            }
        }
        
        Write-Host "`n      ğŸ“Š $stopped Prozesse beendet" -ForegroundColor White
        Read-Host "`n   DrÃ¼cke Enter um fortzufahren"
        & $PSCommandPath
    }
    "5" {
        $reportPath = "$env:USERPROFILE\Desktop\CheatScan_Report_$(Get-Date -Format 'yyyy-MM-dd_HHmm').txt"
        
        $reportContent = @"
INJECTABLE CHEAT SCAN REPORT
============================
Datum: $(Get-Date -Format 'dd.MM.yyyy HH:mm:ss')
Benutzer: $env:USERNAME
Computer: $env:COMPUTERNAME

SCAN ERGEBNISSE:
Kritische Funde: $criticalCount
Warnungen: $warningCount
Total Funde: $($allFindings.Count)

DETAILLIERTE FINDINGS:
"@
        
        foreach ($finding in $allFindings) {
            $reportContent += "`n`n$(if($finding.Type -eq 'CRITICAL'){'[ğŸ”´ CRITICAL]'}else{'[ğŸŸ¡ WARNING]'}) $($finding.Title)"
            foreach ($detail in $finding.Details) {
                $reportContent += "`n  â€¢ $detail"
            }
        }
        
        $reportContent += @"

EMPFEHLUNGEN:
$(
if ($criticalCount -gt 0) {
    "- SOFORT Java-Prozesse beenden"
    "- VerdÃ¤chtige Dateien lÃ¶schen"
    "- Computer neustarten"
} elseif ($warningCount -gt 0) {
    "- VerdÃ¤chtige Mods entfernen"
    "- Temp-Ordner bereinigen"
    "- Scan wiederholen"
} else {
    "- System ist sauber"
    "- RegelmÃ¤ÃŸige Scans empfehlenswert"
}
)
"@
        
        try {
            $reportContent | Out-File -FilePath $reportPath -Encoding UTF8
            Write-Host "`n   ğŸ’¾ Report gespeichert: $reportPath" -ForegroundColor Green
        } catch {
            Write-Host "`n   âŒ Fehler beim Speichern: $($_.Exception.Message)" -ForegroundColor Red
        }
        
        Read-Host "`n   DrÃ¼cke Enter um fortzufahren"
        & $PSCommandPath
    }
    "6" {
        Write-Host "`n   ğŸ‘‹ Beende..." -ForegroundColor Yellow
        Exit
    }
    default {
        Write-Host "`n   âŒ UngÃ¼ltige Auswahl" -ForegroundColor Red
        Start-Sleep -Seconds 2
        & $PSCommandPath
    }
}
