# =====================================================
# ğŸ” BLUE DESKTOP EXE DEEP SCANNER ğŸ”
# Size: 0.5MB - 2.5MB | Recursive Search
# =====================================================

$ErrorActionPreference = "SilentlyContinue"

# ---------------- BLUE THEME UI ----------------
function Show-Banner {
    Clear-Host
    Write-Host ""
    Write-Host "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ" -ForegroundColor DarkBlue
    Write-Host "â–ˆâ–ˆ                                                         â–ˆâ–ˆ" -ForegroundColor DarkBlue
    Write-Host "â–ˆâ–ˆ          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—              â–ˆâ–ˆ" -ForegroundColor DarkBlue
    Write-Host "â–ˆâ–ˆ          â•‘   DEEP DESKTOP EXE SCANNER   â•‘              â–ˆâ–ˆ" -ForegroundColor DarkBlue
    Write-Host "â–ˆâ–ˆ          â•‘    0.5MB - 2.5MB RECURSIVE   â•‘              â–ˆâ–ˆ" -ForegroundColor DarkBlue
    Write-Host "â–ˆâ–ˆ          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•              â–ˆâ–ˆ" -ForegroundColor DarkBlue
    Write-Host "â–ˆâ–ˆ                                                         â–ˆâ–ˆ" -ForegroundColor DarkBlue
    Write-Host "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ" -ForegroundColor DarkBlue
    Write-Host ""
}

function Show-Section($title) {
    Write-Host ""
    Write-Host "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Cyan
    Write-Host "â•‘ $title" -ForegroundColor Cyan
    Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan
}

# ---------------- MAIN SCANNER ----------------
function Start-DesktopScan {
    Show-Banner
    
    Show-Section "ğŸ” SCANNING DESKTOP & DOWNLOADS RECURSIVELY"
    
    # Alle wichtigen Pfade
    $scanPaths = @(
        [System.Environment]::GetFolderPath('Desktop')
        [System.Environment]::GetFolderPath('CommonDesktopDirectory')
        "$env:USERPROFILE\Desktop"
        "$env:USERPROFILE\Downloads"
        "$env:PUBLIC\Desktop"
        "$env:PUBLIC\Downloads"
    )
    
    # Alle EXE Dateien sammeln (rekursiv)
    $allExeFiles = @()
    $totalFilesFound = 0
    
    foreach ($path in $scanPaths) {
        if (Test-Path $path) {
            Write-Host ""
            Write-Host "  ğŸ“ Scanning: $path" -ForegroundColor Blue
            
            try {
                # Rekursiv alle EXEs finden - AUCH VERSTECKTE!
                $exeFiles = Get-ChildItem -Path $path -Recurse -Filter "*.exe" -File -Force -ErrorAction SilentlyContinue
                
                if ($exeFiles.Count -gt 0) {
                    Write-Host "    âœ“ Found $($exeFiles.Count) EXE files" -ForegroundColor Green
                    $allExeFiles += $exeFiles
                    $totalFilesFound += $exeFiles.Count
                } else {
                    Write-Host "    â—‹ No EXE files found" -ForegroundColor Gray
                }
            } catch {
                Write-Host "    âœ— Error scanning: $_" -ForegroundColor Red
            }
        }
    }
    
    Write-Host ""
    Write-Host "  ğŸ“Š Total EXE files found: $totalFilesFound" -ForegroundColor Cyan
    
    if ($totalFilesFound -eq 0) {
        Show-Section "ğŸ“‹ RESULTS"
        Write-Host ""
        Write-Host "    No EXE files found in any scanned location!" -ForegroundColor Yellow
        Read-Host "`nPress Enter to exit"
        return
    }
    
    # EXEs nach GrÃ¶ÃŸe filtern (0.5MB - 2.5MB)
    Show-Section "ğŸ“ FILTERING BY SIZE (0.5MB - 2.5MB)"
    
    $suspiciousFiles = @()
    
    foreach ($exe in $allExeFiles) {
        $sizeMB = [math]::Round($exe.Length / 1MB, 2)
        
        if ($sizeMB -ge 0.5 -and $sizeMB -le 2.5) {
            $suspiciousFiles += [PSCustomObject]@{
                FileName = $exe.Name
                FullPath = $exe.FullName
                SizeMB = $sizeMB
                CreationTime = $exe.CreationTime
                LastWriteTime = $exe.LastWriteTime
                IsHidden = ($exe.Attributes -band [System.IO.FileAttributes]::Hidden)
                IsSystem = ($exe.Attributes -band [System.IO.FileAttributes]::System)
                FolderPath = Split-Path $exe.FullName -Parent
            }
        }
    }
    
    # AUSFÃœHRLICHE LISTE ALLER GEFUNDENEN DATEIEN
    Show-Section "ğŸ“‹ ALL FOUND EXE FILES LIST"
    
    if ($suspiciousFiles.Count -eq 0) {
        Write-Host ""
        Write-Host "    No EXE files found in size range 0.5MB - 2.5MB!" -ForegroundColor Green
    } else {
        Write-Host ""
        Write-Host "    ğŸš¨ FOUND $($suspiciousFiles.Count) SUSPICIOUS EXE FILES (0.5-2.5MB):" -ForegroundColor Red
        Write-Host ""
        
        $counter = 1
        foreach ($file in $suspiciousFiles) {
            # Datei-Info Box
            Write-Host "    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”" -ForegroundColor DarkBlue
            Write-Host "    â”‚ [#$counter] $($file.FileName.PadRight(45)) â”‚" -ForegroundColor DarkBlue
            Write-Host "    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤" -ForegroundColor DarkBlue
            Write-Host "    â”‚ ğŸ“Š Size:    $($file.SizeMB.ToString("0.00").PadRight(8)) MB                      â”‚" -ForegroundColor White
            Write-Host "    â”‚ ğŸ“ Folder:  $(Split-Path $file.FullName -Parent)" -ForegroundColor White
            if ($file.IsHidden) {
                Write-Host "    â”‚ âš ï¸  ATTRIBUTE: HIDDEN FILE                              â”‚" -ForegroundColor Yellow
            }
            if ($file.IsSystem) {
                Write-Host "    â”‚ âš ï¸  ATTRIBUTE: SYSTEM FILE                              â”‚" -ForegroundColor Yellow
            }
            Write-Host "    â”‚ ğŸ“… Created: $($file.CreationTime.ToString('dd.MM.yyyy HH:mm'))               â”‚" -ForegroundColor Gray
            Write-Host "    â”‚ ğŸ“… Modified: $($file.LastWriteTime.ToString('dd.MM.yyyy HH:mm'))              â”‚" -ForegroundColor Gray
            Write-Host "    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜" -ForegroundColor DarkBlue
            Write-Host ""
            
            $counter++
        }
        
        # HASHES anzeigen
        Show-Section "ğŸ” SHA256 HASHES FOR EACH FILE"
        
        $counter = 1
        foreach ($file in $suspiciousFiles) {
            try {
                $hash = (Get-FileHash -Path $file.FullPath -Algorithm SHA256 -ErrorAction SilentlyContinue).Hash
                if ($hash) {
                    Write-Host ""
                    Write-Host "    [#$counter] $($file.FileName)" -ForegroundColor Cyan
                    Write-Host "        $hash" -ForegroundColor Gray
                }
            } catch {
                Write-Host "    [#$counter] $($file.FileName) - Hash error" -ForegroundColor Red
            }
            $counter++
        }
    }
    
    # ZUSAMMENFASSUNG
    Show-Section "ğŸ“Š FINAL SUMMARY"
    
    Write-Host ""
    Write-Host "    ğŸ“ˆ SCAN STATISTICS:" -ForegroundColor Cyan
    Write-Host "    â”œâ”€ Total locations scanned: $($scanPaths.Count)" -ForegroundColor White
    Write-Host "    â”œâ”€ Total EXE files found: $totalFilesFound" -ForegroundColor White
    Write-Host "    â”œâ”€ Files in range 0.5-2.5MB: $($suspiciousFiles.Count)" -ForegroundColor White
    Write-Host "    â””â”€ Hidden files found: $(($suspiciousFiles | Where-Object { $_.IsHidden }).Count)" -ForegroundColor White
    
    Write-Host ""
    Write-Host "    ğŸ“‚ SCANNED PATHS:" -ForegroundColor Cyan
    foreach ($path in $scanPaths) {
        if (Test-Path $path) {
            Write-Host "      âœ“ $path" -ForegroundColor Green
        } else {
            Write-Host "      âœ— $path (not found)" -ForegroundColor Gray
        }
    }
    
    Write-Host ""
    Write-Host "    â±ï¸  Scan completed at: $(Get-Date -Format 'dd.MM.yyyy HH:mm:ss')" -ForegroundColor Gray
    Write-Host ""
    Write-Host "    " + ("â•" * 56) -ForegroundColor DarkBlue
    
    Read-Host "`nPress Enter to exit"
}

# ---------------- START SCAN ----------------
Start-DesktopScan
