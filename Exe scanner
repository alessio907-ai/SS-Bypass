# =====================================================
# ğŸ” BLUE DESKTOP EXE SCANNER ğŸ”
# Size: 0.5MB - 2.5MB
# =====================================================

$ErrorActionPreference = "SilentlyContinue"

# ---------------- BLUE THEME UI ----------------
function Show-Banner {
    Clear-Host
    Write-Host ""
    Write-Host "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ" -ForegroundColor DarkBlue
    Write-Host "â–ˆâ–ˆ                                                â–ˆâ–ˆ" -ForegroundColor DarkBlue
    Write-Host "â–ˆâ–ˆ          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—           â–ˆâ–ˆ" -ForegroundColor DarkBlue
    Write-Host "â–ˆâ–ˆ          â•‘   DESKTOP EXE SCANNER  â•‘           â–ˆâ–ˆ" -ForegroundColor DarkBlue
    Write-Host "â–ˆâ–ˆ          â•‘     0.5MB - 2.5MB      â•‘           â–ˆâ–ˆ" -ForegroundColor DarkBlue
    Write-Host "â–ˆâ–ˆ          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•           â–ˆâ–ˆ" -ForegroundColor DarkBlue
    Write-Host "â–ˆâ–ˆ                                                â–ˆâ–ˆ" -ForegroundColor DarkBlue
    Write-Host "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ" -ForegroundColor DarkBlue
    Write-Host ""
}

function Show-Section($title) {
    Write-Host ""
    Write-Host "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Cyan
    Write-Host "â•‘ $title" -ForegroundColor Cyan
    Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan
}

function Show-Result($text, $type = "info") {
    switch ($type) {
        "info" { 
            Write-Host "  â„¹  " -NoNewline -ForegroundColor Cyan
            Write-Host $text -ForegroundColor White 
        }
        "found" { 
            Write-Host "  âœ“  " -NoNewline -ForegroundColor Green
            Write-Host $text -ForegroundColor White 
        }
        "warning" { 
            Write-Host "  âš   " -NoNewline -ForegroundColor Yellow
            Write-Host $text -ForegroundColor White 
        }
        "error" { 
            Write-Host "  âœ—  " -NoNewline -ForegroundColor Red
            Write-Host $text -ForegroundColor White 
        }
        "suspicious" { 
            Write-Host "  ğŸš¨ " -NoNewline -ForegroundColor Red
            Write-Host $text -ForegroundColor Red 
        }
    }
}

function Show-Progress($current, $total) {
    $percent = [math]::Round(($current / $total) * 100)
    $bars = [math]::Round($percent / 2)
    $progressBar = "[" + ("â–ˆ" * $bars) + ("â–‘" * (50 - $bars)) + "]"
    
    Write-Host "`r  $progressBar $percent% ($current/$total)" -NoNewline -ForegroundColor Blue
}

# ---------------- MAIN SCANNER ----------------
function Start-DesktopScan {
    Show-Banner
    
    Show-Section "ğŸ” SCANNING DESKTOP FOR EXE FILES"
    
    # Desktop Pfad
    $desktopPath = [System.Environment]::GetFolderPath('Desktop')
    
    if (-not (Test-Path $desktopPath)) {
        Show-Result "Desktop path not found!" "error"
        Read-Host "`nPress Enter to exit"
        return
    }
    
    Show-Result "Scanning: $desktopPath" "info"
    
    # Alle EXE Dateien finden
    Show-Result "Searching for EXE files..." "info"
    
    try {
        $allExeFiles = Get-ChildItem -Path $desktopPath -Filter "*.exe" -File -ErrorAction SilentlyContinue
        
        if ($allExeFiles.Count -eq 0) {
            Show-Result "No EXE files found on Desktop" "info"
            Show-Section "ğŸ“Š SCAN RESULTS"
            Show-Result "Total EXE files: 0" "info"
            Show-Result "Files in range 0.5-2.5MB: 0" "info"
            Read-Host "`nPress Enter to exit"
            return
        }
        
        Show-Result "Found $($allExeFiles.Count) EXE files total" "found"
        
        # EXEs nach GrÃ¶ÃŸe filtern
        Show-Result "Checking file sizes (0.5MB - 2.5MB)..." "info"
        Write-Host ""
        
        $suspiciousFiles = @()
        $i = 0
        
        foreach ($exe in $allExeFiles) {
            $i++
            Show-Progress $i $allExeFiles.Count
            
            $sizeMB = [math]::Round($exe.Length / 1MB, 2)
            
            if ($sizeMB -ge 0.5 -and $sizeMB -le 2.5) {
                $suspiciousFiles += [PSCustomObject]@{
                    Name = $exe.Name
                    FullPath = $exe.FullName
                    SizeMB = $sizeMB
                    CreationTime = $exe.CreationTime
                    LastWriteTime = $exe.LastWriteTime
                    IsHidden = ($exe.Attributes -band [System.IO.FileAttributes]::Hidden)
                }
            }
            
            Start-Sleep -Milliseconds 10  # Kleine Pause fÃ¼r Animation
        }
        
        Write-Host "`n"  # New line after progress bar
        
        # Ergebnisse anzeigen
        Show-Section "ğŸ“Š SCAN RESULTS"
        Show-Result "Total EXE files: $($allExeFiles.Count)" "info"
        Show-Result "Files in range 0.5-2.5MB: $($suspiciousFiles.Count)" "warning"
        
        if ($suspiciousFiles.Count -gt 0) {
            Show-Section "ğŸš¨ SUSPICIOUS FILES FOUND"
            
            foreach ($file in $suspiciousFiles) {
                Write-Host ""
                Write-Host "  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”" -ForegroundColor DarkBlue
                Write-Host "  â”‚ File: $($file.Name.PadRight(36)) â”‚" -ForegroundColor DarkBlue
                Write-Host "  â”‚ Size: $($file.SizeMB.ToString("0.00").PadRight(6)) MB (0.5-2.5MB range) â”‚" -ForegroundColor DarkBlue
                Write-Host "  â”‚ Path: $($file.FullPath.PadRight(36)) â”‚" -ForegroundColor DarkBlue
                
                if ($file.IsHidden) {
                    Write-Host "  â”‚ âš  HIDDEN FILE                           â”‚" -ForegroundColor Yellow
                }
                
                Write-Host "  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜" -ForegroundColor DarkBlue
            }
            
            # Hash fÃ¼r Beweise
            Show-Section "ğŸ” FILE HASHES (SHA256)"
            foreach ($file in $suspiciousFiles) {
                try {
                    $hash = (Get-FileHash -Path $file.FullPath -Algorithm SHA256 -ErrorAction SilentlyContinue).Hash
                    if ($hash) {
                        Write-Host "  [$($file.Name)]" -ForegroundColor Cyan
                        Write-Host "  $hash" -ForegroundColor Gray
                        Write-Host ""
                    }
                } catch {
                    Write-Host "  [$($file.Name)] Error getting hash" -ForegroundColor Gray
                }
            }
        }
        
        # Zusammenfassung
        Show-Section "ğŸ“‹ SUMMARY"
        if ($suspiciousFiles.Count -eq 0) {
            Write-Host ""
            Write-Host "  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Green
            Write-Host "  â•‘         SCAN COMPLETED              â•‘" -ForegroundColor Green
            Write-Host "  â•‘      No suspicious files found      â•‘" -ForegroundColor Green
            Write-Host "  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Green
        } else {
            Write-Host ""
            Write-Host "  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Red
            Write-Host "  â•‘         WARNING!                    â•‘" -ForegroundColor Red
            Write-Host "  â•‘   $($suspiciousFiles.Count) suspicious files found  â•‘" -ForegroundColor Red
            Write-Host "  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Red
        }
        
    } catch {
        Show-Result "Error during scan: $_" "error"
    }
    
    Write-Host ""
    Write-Host "â•" * 50 -ForegroundColor DarkBlue
    Show-Result "Scan completed at: $(Get-Date -Format 'HH:mm:ss')" "info"
    Write-Host "â•" * 50 -ForegroundColor DarkBlue
    
    Read-Host "`nPress Enter to exit"
}

# ---------------- START SCAN ----------------
Start-DesktopScan
